(function(e){var t=e("ul#wpuf-form-editor"),n={init:function(){this.makeSortable();this.tooltip();this.tabber();this.showHideHelp();e("#wpuf-metabox-settings").on("change",'select[name="wpuf_settings[redirect_to]"]',this.settingsRedirect);e("#wpuf-metabox-settings-update").on("change",'select[name="wpuf_settings[edit_redirect_to]"]',this.settingsRedirect);e('select[name="wpuf_settings[redirect_to]"]').change();e('select[name="wpuf_settings[edit_redirect_to]"]').change();e("#wpuf-metabox-settings").on("change",'input[type=checkbox][name="wpuf_settings[guest_post]"]',this.settingsGuest);e('input[type=checkbox][name="wpuf_settings[guest_post]"]').trigger("change");e("#wpuf-metabox-settings").on("change",'input[type=checkbox][name="wpuf_settings[guest_details]"]',this.settingsGuestDetails);e("button.wpuf-collapse").on("click",this.collpaseEditFields);e(".wpuf-form-buttons").on("click","button",this.addNewField);e("#wpuf-form-editor").on("click",".wpuf-remove",this.removeFormField);e("#wpuf-form-editor").on("change",'li.custom-field input[data-type="label"]',this.setMetaKey);e("#wpuf-form-editor").on("change",".wpuf-form-sub-fields input[type=text]",function(){e(this).prev("input[type=checkbox], input[type=radio]").val(e(this).val())});e("#wpuf-form-editor").on("click","input[type=checkbox].multicolumn",function(){var t=e(this),n=t.closest(".wpuf-form-rows");if(t.is(":checked")){n.next().hide().next().hide();n.siblings(".column-names").show()}else{n.next().show().next().show();n.siblings(".column-names").hide()}});e("#wpuf-form-editor").on("click","input[type=checkbox].retype-pass",function(){var t=e(this),n=t.closest(".wpuf-form-rows");t.is(":checked")?n.next().show().next().show():n.next().hide().next().hide()});e("#wpuf-form-editor").on("click",".wpuf-toggle",this.toggleFormField);e("#wpuf-form-editor").on("click","img.wpuf-clone-field",this.cloneField);e("#wpuf-form-editor").on("click","img.wpuf-remove-field",this.removeField)},showHideHelp:function(){var t=e("ul#wpuf-form-editor").children("li");t.length?e(".wpuf-updated").hide():e(".wpuf-updated").show()},makeSortable:function(){t=e("ul#wpuf-form-editor");t&&t.sortable({placeholder:"ui-state-highlight",handle:"> .wpuf-legend",distance:5})},addNewField:function(t){t.preventDefault();var r=e(this),i=e("ul#wpuf-form-editor"),s=r.data("name"),o=r.data("type"),u={name:s,type:o,order:i.find("li").length+1,action:"wpuf_form_add_el"},a=["post_title","post_content","post_excerpt","featured_image","user_login","first_name","last_name","nickname","user_email","user_url","user_bio","password","user_avatar"];if(e.inArray(s,a)>=0&&i.find("li."+s).length){alert("You already have this field in the form");return!1}e(".wpuf-loading").removeClass("hide");e.post(ajaxurl,u,function(t){i.append(t);n.makeSortable();n.tooltip();e(".wpuf-loading").addClass("hide");n.showHideHelp()})},removeFormField:function(t){t.preventDefault();confirm("are you sure?")&&e(this).closest("li").fadeOut(function(){e(this).remove();n.showHideHelp()})},toggleFormField:function(t){t.preventDefault();e(this).closest("li").find(".wpuf-form-holder").slideToggle("fast")},cloneField:function(t){t.preventDefault();var n=e(this).closest("div"),r=n.clone();r.find("input").val("");r.find(":checked").attr("checked","");n.after(r)},removeField:function(){var t=e(this).closest("div"),n=t.siblings().andSelf().length;n>1&&t.remove()},setMetaKey:function(){var t=e(this),n=t.val().toLowerCase().split(" ").join("_").split("'").join(""),r=e(this).closest(".wpuf-form-rows").next().find("input[type=text]");r.length&&r.val(n)},tooltip:function(){e(".smallipopInput").smallipop({preferredPosition:"right",theme:"black",popupOffset:0,triggerOnClick:!0})},collpaseEditFields:function(t){t.preventDefault();e("ul#wpuf-form-editor").children("li").find(".wpuf-form-holder").slideToggle()},settingsGuest:function(t){t.preventDefault();var n=e(this).closest("table");if(e(this).is(":checked")){n.find("tr.show-if-guest").show();n.find("tr.show-if-not-guest").hide();e('input[type=checkbox][name="wpuf_settings[guest_details]"]').trigger("change")}else{n.find("tr.show-if-guest").hide();n.find("tr.show-if-not-guest").show()}},settingsGuestDetails:function(t){t.preventDefault();var n=e(this).closest("table");e(this).is(":checked")?n.find("tr.show-if-details").show():n.find("tr.show-if-details").hide()},settingsRedirect:function(t){t.preventDefault();var n=e(this),r=n.closest("table"),i=n.val();switch(i){case"post":r.find("tr.wpuf-page-id, tr.wpuf-url, tr.wpuf-same-page").hide();break;case"page":r.find("tr.wpuf-page-id").show();r.find("tr.wpuf-same-page").hide();r.find("tr.wpuf-url").hide();break;case"url":r.find("tr.wpuf-page-id").hide();r.find("tr.wpuf-same-page").hide();r.find("tr.wpuf-url").show();break;case"same":r.find("tr.wpuf-page-id").hide();r.find("tr.wpuf-url").hide();r.find("tr.wpuf-same-page").show()}},tabber:function(){e(".group").hide();e(".group:first").fadeIn();e(".group .collapsed").each(function(){e(this).find("input:checked").parent().parent().parent().nextAll().each(function(){if(e(this).hasClass("last")){e(this).removeClass("hidden");return!1}e(this).filter(".hidden").removeClass("hidden")})});e(".nav-tab-wrapper a:first").addClass("nav-tab-active");e(".nav-tab-wrapper a").click(function(t){e(".nav-tab-wrapper a").removeClass("nav-tab-active");e(this).addClass("nav-tab-active").blur();var n=e(this).attr("href");e(".group").hide();e(n).fadeIn();t.preventDefault()})}};e(function(){n.init()})})(jQuery);